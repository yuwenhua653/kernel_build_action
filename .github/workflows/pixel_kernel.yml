name: Build Pixel 6 Kernel 6.12 (Standalone)

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: 1. 释放空间并安装交叉编译器
        run: |
          sudo rm -rf /usr/share/dotnet /usr/local/lib/android /opt/ghc /usr/local/share/boost "$AGENT_TOOLSDIRECTORY"
          sudo apt-get update
          sudo apt-get install -y bc build-essential flex bison libssl-dev libelf-dev git-lfs python3 gcc-aarch64-linux-gnu

      - name: 2. 克隆 Pixel 6 专属内核源码
        run: |
          # 针对 Pixel 6 (gs101) 的 6.12 核心代码库
          git clone --depth=1 https://android.googlesource.com/kernel/common -b android-mainline-6.12 kernel-source

      - name: 3. 编译内核本体
        working-directory: ./kernel-source
        run: |
          export ARCH=arm64
          export CROSS_COMPILE=aarch64-linux-gnu-
          # 使用 Pixel 6 的默认配置 (gki 基础配置)
          make gki_defconfig
          # 编译 Image 和 压缩后的镜像
          make -j$(nproc) Image.lz4

      - name: 4. 下载打包工具 (Android Image Kitchen)
        run: |
          git clone https://github.com/osm0sis/Android-Image-Kitchen.git AIK
          # 准备一个标准的 Pixel 6 boot.img 作为模板 (你可以替换为你的模板链接)
          # 这里如果没有模板，我们先只上传内核本体

      - name: 5. 上传产物
        uses: actions/upload-artifact@v4
        with:
          name: Pixel6-612-Kernel-Image
          path: |
            kernel-source/arch/arm64/boot/Image.lz4
            kernel-source/.config
